{% set version = "0.9.25" %}

package:
  name: lmdb
  version: {{ version }}

source:
  url: https://github.com/LMDB/lmdb/archive/LMDB_{{ version }}.tar.gz
  sha256: 5320a24f27e40cd4a00a2e5eaf37d80186835bd4d63a9adefcf90987dfa71ee4
  patches:
    - patches/Makefile.patch

build:
  number: 0
  skip: true  # [win]

requirements:
  build:
    - make
    - {{ compiler('c') }}

test:
  commands:
    # binaries
    - mdb_copy -V                                    # [unix]
    - mdb_dump -V                                    # [unix]
    - mdb_load -V                                    # [unix]
    - mdb_stat -V                                    # [unix]

    # shared:
    - test -f ${PREFIX}/lib/liblmdb.so               # [unix]
    - if not exist %LIBRARY_BIN%\lmdb.dll exit 1     # [win]

    # TODO: do we want to do have static libraries at all?
    # static:
    - test -f ${PREFIX}/lib/liblmdb.a                # [not win]

    # headers:
    - test -f ${PREFIX}/include/lmdb.h               # [unix]
    - if not exist %LIBRARY_INC%\lmdb.h exit 1       # [win]

about:
  home: https://www.openldap.org/software/repo.html
  license: OLDAP-2.8
  license_file: libraries/liblmdb/LICENSE
  summary: A high-performance embedded transactional key-value store database.
  # careful: the gitlab repo has different branches for very
  # different projects relevant here are the ones called mdb.*;
  # also: there's a mirror under https://github.com/LMDB/lmdb
  dev_url: https://git.openldap.org/openldap/openldap/-/tree/mdb.master

extra:
  recipe-maintainers:
    - jakirkham
    - h-vetinari
